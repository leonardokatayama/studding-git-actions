name: deploy-wapis-workflow
on: [push]
jobs:
  deploy-to-server:
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v3

      - name: Make env file
        uses: SpicyPizza/create-envfile@v2.0
        with:
          envkey_DATABASE_URL: "postgres://prisma:prisma@127.0.0.1:15432/tests"
          file_name: .env.test

      - name: Setup node
        uses: actions/setup-node@v3
        with:
          node-version: 18.16.1
          cache: "yarn"

      - name: Install yarn dependencies
        run: yarn install

      - name: Run build task
        run: yarn build

      - name: Workdir
        run: echo $GITHUB_WORKSPACE